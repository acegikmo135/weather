<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Weather Hub</title>
    <!-- Leaflet CSS for the map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap');

        :root {
            --primary-text: #e0e5f0;
            --secondary-text: #8a99b5;
            --background-1: #0d101c;
            --background-2: #15192c;
            --card-background: rgba(21, 25, 44, 0.8);
            --card-border: rgba(255, 255, 255, 0.1);
            --glow-color: rgba(0, 246, 255, 0.7);
            --highlight-color: #00f6ff;
            --graph-grad-start: #5ee3ff;
            --graph-grad-end: #ff8a63;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            color: var(--primary-text);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 5vh 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            background-color: var(--background-1);
        }
        
        #animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(315deg, var(--background-1), var(--background-2));
            background-size: 400% 400%;
            animation: gradientDrift 25s ease infinite;
        }

        .weather-app {
            background-color: var(--card-background);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-radius: 30px;
            width: 100%;
            max-width: 600px;
            border: 1px solid var(--card-border);
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            overflow: hidden;
        }

        .weather-app.collapsed {
            padding: 20px 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .weather-app:not(.collapsed) {
            padding: 30px 35px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5), 0 0 20px var(--glow-color);
        }

        .search-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: rgba(0,0,0,0.2);
            border-radius: 15px;
            padding: 5px;
            border: 1px solid var(--card-border);
            transition: box-shadow 0.3s ease;
        }
        .search-container:focus-within {
            box-shadow: 0 0 15px var(--glow-color);
        }
        #city-search {
            flex-grow: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--primary-text);
            font-size: 16px;
            padding: 10px 15px;
        }
        #city-search::placeholder { color: var(--secondary-text); }
        .icon-btn {
            background: var(--highlight-color);
            border: none;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            display: grid;
            place-items: center;
            transition: transform 0.2s ease;
        }
        .icon-btn:hover { transform: scale(1.1); }
        .icon-btn svg { width: 20px; height: 20px; stroke: var(--background-1); }
        
        .weather-content-wrapper {
            max-height: 0;
            opacity: 0;
            visibility: hidden;
            transition: max-height 1s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.5s 0.3s ease, visibility 0s 1s;
        }
        .weather-app:not(.collapsed) .weather-content-wrapper {
            max-height: 2000px; /* Large value to allow expansion */
            opacity: 1;
            visibility: visible;
            transition: max-height 1s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.5s 0.3s ease, visibility 0s 0s;
        }

        .location-info { text-align: center; margin: 25px 0 20px; }
        #city-name { font-size: 32px; font-weight: 700; margin-bottom: 5px; }
        #current-date { color: var(--secondary-text); }
        
        .current-weather { text-align: center; margin-bottom: 30px; }
        .current-weather .temperature { font-size: 7rem; font-weight: 300; line-height: 1; }
        .current-weather .temperature sup { font-size: 0.4em; vertical-align: super; }
        .current-weather .condition { font-size: 24px; font-weight: 500; margin: 10px 0; }
        .current-weather .temp-range { font-size: 18px; color: var(--secondary-text); }
        
        .hourly-forecast { margin-bottom: 30px; position: relative; height: 170px; }
        .hourly-scroll-wrapper {
             overflow-x: auto;
             overflow-y: hidden;
             white-space: nowrap;
             padding-bottom: 15px;
        }
        .hourly-scroll-wrapper::-webkit-scrollbar { height: 6px; }
        .hourly-scroll-wrapper::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 3px; }
        .hourly-scroll-wrapper::-webkit-scrollbar-thumb { background: linear-gradient(90deg, var(--graph-grad-start), var(--graph-grad-end)); border-radius: 3px; }
        
        .hourly-item { display: inline-block; text-align: center; width: 80px; vertical-align: bottom; transition: transform 0.3s ease, background-color 0.3s ease; padding: 10px 0; border-radius: 15px; cursor: pointer; }
        .hourly-item:hover { transform: translateY(-8px) scale(1.05); background-color: rgba(255, 255, 255, 0.05); }
        .hourly-item .time { font-size: 14px; color: var(--secondary-text); margin-bottom: 25px; }
        .hourly-item .icon { font-size: 26px; margin-bottom: 15px; }
        .hourly-item .temp { font-size: 18px; font-weight: 500; }
        #hourly-canvas { position: absolute; bottom: 75px; left: 0; width: 100%; height: 70px; pointer-events: none; }
        
        .daily-forecast { border-top: 1px solid var(--card-border); padding-top: 20px; }
        .daily-item { display: flex; align-items: center; margin-bottom: 10px; transition: background-color 0.3s ease, transform 0.3s ease; padding: 12px 15px; border-radius: 12px; }
        .daily-item:hover { background-color: rgba(255, 255, 255, 0.08); transform: translateX(10px); }
        .daily-item .day { font-weight: 500; flex: 2; }
        .daily-item .icon-chance { display: flex; align-items: center; gap: 15px; flex: 1; justify-content: center; }
        .daily-item .icon { font-size: 24px; }
        .daily-item .temp-range { font-weight: 500; flex: 2; text-align: right; }
        
        .view-more { text-align: center; margin: 20px 0; }
        .view-more-btn { background: none; border: 1px solid var(--secondary-text); color: var(--secondary-text); padding: 10px 25px; border-radius: 25px; cursor: pointer; transition: all 0.3s; font-weight: 500; }
        .view-more-btn:hover { background-color: var(--highlight-color); border-color: var(--highlight-color); color: var(--card-background); transform: scale(1.05); }
        
        .weather-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; margin-top: 0; border-top: 1px solid var(--card-border); padding-top: 0; max-height: 0; opacity: 0; overflow: hidden; transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
        .weather-app.details-expanded .weather-details { max-height: 500px; opacity: 1; padding-top: 20px; margin-top: 20px; }
        
        .detail-card { background-color: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 20px; text-align: center; transition: transform 0.3s, box-shadow 0.3s; }
        .detail-card:hover { transform: translateY(-8px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .detail-card .label { font-size: 13px; color: var(--secondary-text); margin-bottom: 8px; }
        .detail-card .value { font-size: 18px; font-weight: 500; }
        .detail-card .icon { margin-bottom: 10px; }
        .detail-card .icon svg { width: 28px; height: 28px; stroke: var(--highlight-color); stroke-width: 1.5; }
        
        .animated-entry {
            opacity: 0;
            transform: translateY(20px);
            animation: itemFadeInUp 0.6s ease-out forwards;
        }

        #map-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            display: none; /* Initially hidden */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        #map {
            width: 90%;
            height: 75%;
            max-width: 800px;
            border-radius: 15px;
        }
        #select-location-btn {
            display: none; /* Hide until a location is clicked */
            border-color: var(--highlight-color);
            color: var(--highlight-color);
        }

        @keyframes gradientDrift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes itemFadeInUp { to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

<div id="animated-bg"></div>

<div class="weather-app collapsed" id="weather-app">
    <form class="search-container" id="search-form">
        <button id="map-btn" type="button" class="icon-btn">
            <svg xmlns="http://www.w.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
        </button>
        <input type="text" id="city-search" placeholder="Enter area name or lat,lon..." autocomplete="off">
        <button id="search-btn" type="submit" class="icon-btn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        </button>
    </form>
    
    <div class="weather-content-wrapper">
        <div class="location-info">
            <h1 id="city-name"></h1>
            <p id="current-date"></p>
        </div>

        <div class="weather-content" id="weather-content">
            <div class="current-weather"></div>
            <div class="hourly-forecast">
                <canvas id="hourly-canvas"></canvas>
                <div class="hourly-scroll-wrapper" id="hourly-scroll-wrapper"></div>
            </div>
            <div class="daily-forecast" id="daily-forecast"></div>
            <div class="view-more">
                <button class="view-more-btn" id="view-more-btn">View More</button>
            </div>
            <div class="weather-details" id="weather-details"></div>
        </div>
    </div>
</div>

<div id="map-container">
    <div id="map"></div>
    <button id="select-location-btn" class="view-more-btn">Select This Location</button>
</div>

<!-- Leaflet JavaScript -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // --- DOM ELEMENTS ---
    const app = document.getElementById('weather-app');
    const searchForm = document.getElementById('search-form');
    const searchInput = document.getElementById('city-search');
    const cityNameEl = document.getElementById('city-name');
    const currentDateEl = document.getElementById('current-date');
    const currentContainer = document.querySelector('.current-weather');
    const hourlyWrapper = document.getElementById('hourly-scroll-wrapper');
    const dailyContainer = document.getElementById('daily-forecast');
    const detailsContainer = document.getElementById('weather-details');
    const viewMoreBtn = document.getElementById('view-more-btn');
    const mapBtn = document.getElementById('map-btn');
    const mapContainer = document.getElementById('map-container');
    const selectLocationBtn = document.getElementById('select-location-btn');

    let map, marker, selectedCoords;

    // --- MAP INITIALIZATION ---
    function initMap() {
        map = L.map('map').setView([20.5937, 78.9629], 5); // Default to India
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap'
        }).addTo(map);

        marker = L.marker([0, 0]); // Create an empty marker

        map.on('click', function(e) {
            selectedCoords = e.latlng;
            if (!map.hasLayer(marker)) {
                marker.addTo(map);
            }
            marker.setLatLng(selectedCoords);
            selectLocationBtn.style.display = 'block'; // Show selection button
        });
    }

    // --- HELPER FUNCTIONS ---
    const weatherIcons = {
        0: '☀️', 1: '🌤️', 2: '⛅️', 3: '☁️', 45: '🌫️', 48: '🌫️',
        51: '🌦️', 53: '🌦️', 55: '🌦️', 56: '🌧️', 57: '🌧️',
        61: '🌧️', 63: '🌧️', 65: '🌧️', 66: '🌨️', 67: '🌨️',
        71: '🌨️', 73: '🌨️', 75: '🌨️', 77: '🌨️',
        80: '🌧️', 81: '🌧️', 82: '🌧️',
        85: '🌨️', 86: '🌨️',
        95: '⛈️', 96: '⛈️', 99: '⛈️'
    };
    const weatherConditions = {
        0: 'Clear sky', 1: 'Mainly clear', 2: 'Partly cloudy', 3: 'Overcast', 45: 'Fog', 48: 'Rime fog',
        51: 'Light drizzle', 53: 'Moderate drizzle', 55: 'Dense drizzle', 56: 'Light freezing drizzle', 57: 'Dense freezing drizzle',
        61: 'Slight rain', 63: 'Moderate rain', 65: 'Heavy rain', 66: 'Light freezing rain', 67: 'Heavy freezing rain',
        71: 'Slight snow', 73: 'Moderate snow', 75: 'Heavy snow', 77: 'Snow grains',
        80: 'Slight showers', 81: 'Moderate showers', 82: 'Violent showers',
        85: 'Slight snow showers', 86: 'Heavy snow showers',
        95: 'Thunderstorm', 96: 'Thunderstorm, slight hail', 99: 'Thunderstorm, heavy hail'
    };
    function degreesToCardinal(deg) {
        const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
        return directions[Math.round(deg / 22.5) % 16];
    }
    const staggerAnimation = (elements, baseDelay = 0) => {
        elements.forEach(el => el.classList.remove('animated-entry'));
        setTimeout(() => {
            elements.forEach((el, i) => {
                el.style.animationDelay = `${baseDelay + i * 0.08}s`;
                el.classList.add('animated-entry');
            });
        }, 10);
    };

    // --- MAIN UI POPULATION ---
    const updateWeatherUI = (data) => {
        [currentContainer, hourlyWrapper, dailyContainer, detailsContainer].forEach(el => el.innerHTML = '');

        currentDateEl.textContent = new Date().toLocaleDateString('en-US', {
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });

        currentContainer.innerHTML = `
            <div class="temperature">${Math.round(data.current.temperature_2m)}<sup>°C</sup></div>
            <div class="condition">${weatherConditions[data.current.weather_code] || 'N/A'}</div>
            <div class="temp-range">${Math.round(data.daily.temperature_2m_min[0])}° ~ ${Math.round(data.daily.temperature_2m_max[0])}°C</div>`;
        staggerAnimation(Array.from(currentContainer.children), 0.4);

        const hourlyDataForGraph = [];
        const currentTime = new Date(data.current.time);
        const startHour = currentTime.getHours();
        for (let i = startHour; i < startHour + 24 && i < data.hourly.time.length; i++) {
            const item = document.createElement('div');
            item.className = 'hourly-item';
            const time = new Date(data.hourly.time[i]);
            const temp = Math.round(data.hourly.temperature_2m[i]);
            hourlyDataForGraph.push({ temp });

            item.innerHTML = `
                <div class="time">${i === startHour ? 'Now' : time.getHours() + ':00'}</div>
                <div class="icon">${weatherIcons[data.hourly.weather_code[i]] || '❓'}</div>
                <div class="temp">${temp}°</div>`;
            hourlyWrapper.appendChild(item);
        }
        staggerAnimation(Array.from(hourlyWrapper.children), 0.6);
        
        for (let i = 0; i < 7 && i < data.daily.time.length; i++) {
            const item = document.createElement('div');
            item.className = 'daily-item';
            const date = new Date(data.daily.time[i]);
            const dayName = i === 0 ? 'Today' : date.toLocaleDateString('en-US', { weekday: 'short' });

            item.innerHTML = `
                <div class="day">${dayName}</div>
                <div class="icon-chance"><div class="icon">${weatherIcons[data.daily.weather_code[i]] || '❓'}</div></div>
                <div class="temp-range">${Math.round(data.daily.temperature_2m_min[i])}° &nbsp; <span style="color: var(--secondary-text)">${Math.round(data.daily.temperature_2m_max[i])}°</span></div>`;
            dailyContainer.appendChild(item);
        }
        staggerAnimation(Array.from(dailyContainer.children), 0.8);
        
        let currentHourIndex = data.hourly.time.findIndex(t => t === data.current.time);
        if (currentHourIndex === -1) currentHourIndex = startHour;

        const details = [
            { label: 'Feels like', value: `${Math.round(data.current.apparent_temperature)}°C`, icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/></svg>` },
            { label: 'Wind', value: `${data.current.wind_speed_10m} km/h ${degreesToCardinal(data.current.wind_direction_10m)}`, icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>` },
            { label: 'Humidity', value: `${data.current.relative_humidity_2m}%`, icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>` },
            { label: 'UV Index', value: `${Math.round(data.daily.uv_index_max[0])}`, icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m4.93 19.07 1.41-1.41"/><path d="m17.66 6.34 1.41-1.41"/></svg>` },
            { label: 'Visibility', value: `${(data.hourly.visibility[currentHourIndex] / 1000).toFixed(1)} km`, icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>` },
            { label: 'Pressure', value: `${Math.round(data.current.surface_pressure)} hPa`, icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 12v6.5a6.5 6.5 0 1 1-6.5-6.5h13a6.5 6.5 0 1 1-6.5 6.5V12"/><path d="m12 12 4-4"/><path d="m8 8 4 4"/><path d="m12 2 4 4"/><path d="m8 16 4-4"/></svg>` },
        ];
        details.forEach(itemData => {
            const item = document.createElement('div');
            item.className = 'detail-card';
            item.innerHTML = `<div class="icon">${itemData.icon}</div><div class="label">${itemData.label}</div><div class="value">${itemData.value}</div>`;
            detailsContainer.appendChild(item);
        });
        drawHourlyGraph(hourlyDataForGraph);
    };

    // --- API & DATA FETCHING ---
    async function getCoordinates(query) {
        const coords = query.match(/^(-?\d+\.?\d*)[,\s]+(-?\d+\.?\d*)$/);
        if (coords) return { lat: parseFloat(coords[1]), lon: parseFloat(coords[2]), name: "Selected Location" };
        const response = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=1&language=en&format=json`);
        if (!response.ok) { alert("Could not find location."); return null; }
        const data = await response.json();
        if (!data.results) { alert("Location not found."); return null; }
        const loc = data.results[0];
        return { lat: loc.latitude, lon: loc.longitude, name: `${loc.name}, ${loc.country}` };
    }

    async function getWeatherData(lat, lon) {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,surface_pressure,wind_speed_10m,wind_direction_10m&hourly=temperature_2m,weather_code,visibility&daily=weather_code,temperature_2m_max,temperature_2m_min,uv_index_max&timezone=auto`;
        const response = await fetch(url);
        if (!response.ok) { alert("Failed to fetch weather data."); return null; }
        return await response.json();
    }
    
    // --- EVENT LISTENERS ---
    searchForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const query = searchInput.value.trim();
        if (!query) return;

        const location = await getCoordinates(query);
        if (!location) return;

        const weatherData = await getWeatherData(location.lat, location.lon);
        if (!weatherData) return;

        cityNameEl.textContent = location.name;
        app.classList.remove('collapsed');
        setTimeout(() => updateWeatherUI(weatherData), 300);
    });

    viewMoreBtn.addEventListener('click', () => {
        const isExpanding = !app.classList.contains('details-expanded');
        app.classList.toggle('details-expanded');
        viewMoreBtn.textContent = isExpanding ? 'Collapse' : 'View More';
        if (isExpanding) staggerAnimation(Array.from(detailsContainer.children), 0);
    });

    mapBtn.addEventListener('click', () => {
        mapContainer.style.display = 'flex';
        if (!map) initMap();
        setTimeout(() => map.invalidateSize(), 10); 
    });

    selectLocationBtn.addEventListener('click', () => {
        if (selectedCoords) {
            searchInput.value = `${selectedCoords.lat.toFixed(4)}, ${selectedCoords.lng.toFixed(4)}`;
            mapContainer.style.display = 'none';
            selectLocationBtn.style.display = 'none';
            searchForm.requestSubmit();
        }
    });

    mapContainer.addEventListener('click', (e) => {
        if (e.target.id === 'map-container') mapContainer.style.display = 'none';
    });

    // --- CANVAS GRAPH FUNCTION ---
    function drawHourlyGraph(hourlyData) {
        const canvas = document.getElementById('hourly-canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const temps = hourlyData.map(d => d.temp);
        const minTemp = Math.min(...temps), maxTemp = Math.max(...temps);
        const tempRange = maxTemp - minTemp;
        let animationProgress = 0;

        function resizeCanvas() {
            const dpr = window.devicePixelRatio || 1;
            canvas.width = canvas.offsetWidth * dpr;
            canvas.height = canvas.offsetHeight * dpr;
            ctx.scale(dpr, dpr);
        }

        const spacing = 80;
        const points = temps.map((temp, i) => ({
            x: i * spacing + spacing / 2,
            y: tempRange === 0 ? canvas.offsetHeight / 2 :
               canvas.offsetHeight * 0.8 - ((temp - minTemp) / tempRange * canvas.offsetHeight * 0.6)
        }));

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if(points.length === 0) return;
            
            ctx.beginPath();
            ctx.moveTo(points[0].x, points[0].y);
            for (let i = 0; i < points.length - 1; i++) {
                const x_mid = (points[i].x + points[i+1].x) / 2;
                const y_mid = (points[i].y + points[i+1].y) / 2;
                ctx.quadraticCurveTo(points[i].x, points[i].y, x_mid, y_mid);
            }
            ctx.lineTo(points[points.length - 1].x, points[points.length - 1].y);
            
            const lineGradient = ctx.createLinearGradient(0, 0, hourlyWrapper.scrollWidth, 0);
            lineGradient.addColorStop(0, 'var(--graph-grad-start)');
            lineGradient.addColorStop(1, 'var(--graph-grad-end)');
            ctx.strokeStyle = lineGradient;
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            ctx.stroke();

            ctx.lineTo(points[points.length - 1].x, canvas.offsetHeight);
            ctx.lineTo(points[0].x, canvas.offsetHeight);
            ctx.closePath();

            const fillGradient = ctx.createLinearGradient(0, 0, 0, canvas.offsetHeight);
            fillGradient.addColorStop(0, 'rgba(94, 227, 255, 0.2)');
            fillGradient.addColorStop(1, 'rgba(255, 138, 99, 0)');
            ctx.fillStyle = fillGradient;
            ctx.fill();

            points.forEach((p, index) => {
                const popInFactor = Math.max(0, (animationProgress - (index / points.length) * 0.8) / 0.2);
                if (popInFactor > 0) {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 5 * popInFactor, 0, 2 * Math.PI);
                    ctx.fillStyle = '#fff';
                    ctx.fill();
                }
            });
        }
        
        function animate() {
            if (animationProgress < 1) {
                animationProgress += 0.015;
                requestAnimationFrame(animate);
            } else {
                animationProgress = 1;
            }
            draw();
        }
        
        setTimeout(() => {
             resizeCanvas();
             window.addEventListener('resize', resizeCanvas);
             animate();
        }, 800);
    }
});
</script>
</body>
</html>
